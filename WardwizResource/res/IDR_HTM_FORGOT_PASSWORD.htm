<html custom-frame="solid-with-shadow" lang="ENGLISH">
	<head>
	<link href="IDR_TIS_ENGLISH.tis" hreflang="ENGLISH" rel="translation">
	<link href="IDR_TIS_GERMAN.tis" hreflang="GERMAN" rel="translation">
	<include src="IDR_HTM_FONT_AWESOME.htm" />	
	<style>
	@import url(IDR_CSS_GERMAN_LANG.css);
	@import url(IDR_CSS_MAIN.css);

	html 
	{ 
		width:380dip;           /* preferred/initial width */
		height:313dip;          /* content will not overflow, no vertical scrollbars on the window */  
		overflow:hidden;
	}

	.message_display_block_forgotPassword:collapsed {
		visibility:visible;
		top:40dip;
		transition:top(sine-in-out, 600ms);
	}
	body.forgotPassword{ 
		max-width:378.5dip!important;
		height:312dip;
		background-size:cover;
		padding:0; margin:0; 
		border:0.5dip solid #3d748e;  
	}
	.header_forgotPassword{
		background:rgba(0,0,0,.3);
		flow:horizontal;
		width:378.5dip;        
		height:40dip;
	}
	.set_label_information_forgot_password{
		margin-top:8dip;
		margin-left:20dip;
		margin-right:20dip;
	}
	.set_txt_forgotPassword{
		margin-left:20dip;
		margin-top:5dip;
	}
	.set_txt_answer{
		width:80dip;
		display:inline-block;
		text-align:left;
	}
	.input_password_forgotPassword{
		margin-left:5dip;
		width:244dip;
	}
	.btnIcon_forgotPassword{
		margin-left:105dip;
		margin-top:0;
	}
	.message_display_block_forgotPassword {
		background:rgba(238,246,248,.95);
		position:absolute;
		width:378dip;
		height:auto;
		visibility:none;
		margin-left:0dip;
		top:0;
	}
	.message_display_block_forgotPassword p{
		margin-top:0;
		margin-bottom:0dip;
		text-align:center;
		padding-top:3dip;
		padding-bottom:3dip;
		color:#000;
	}
	</style>
		
	<script type="text/tiscript">
	include "IDR_TIS_SQLITE.tis";
	</script>
	
	<script type="text/tiscript">
	var varDB;
	var DataBase;
	</script>
	
	<script type="text/tiscript">
	function ValidateEmailID()
	{
		var varEmailId = $(#ID_TXT_EMAIL).value;        
		var spregexp = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/gi;
        var matchesArraySp = varEmailId.search(spregexp);
		if(matchesArraySp < 0 )
        {
            return false;
        }
		return true;	
	}
	
	function ValidateQuestion()
	{
		DataBase = DB.open(varDB);
		var vQuestion = $(#ID_DDBTN_QUESTIONS).value;
		var vCheckQuestion = DataBase.exec("SELECT ANSWER, QUESTION FROM WWIZ_FORGETPASSWORD WHERE QUESTION = ?",vQuestion);
		if(vCheckQuestion instanceof Recordset && vCheckQuestion != 101)
		{
			if(vCheckQuestion["ANSWER"] == $(#ID_TXT_ANSWER).value.trim())
			{
				return true;
			}
		}
		return false;
	}
	
	function GetPassword()
	{
		var vPwd="";
		DataBase = DB.open(varDB);
		var vPassword = DataBase.exec("SELECT PASSWORD FROM WWIZ_PWDFORPWDSCOPE");
		if(vPassword instanceof Recordset)
		{
			vPwd = vPassword["PASSWORD"];
			vPassword.close();
		}
		DataBase.close();
		return vPwd;
	}
	
	$(#ID_BTN_GO).onClick = function()
	{
		FunCheckPwdValid();
	}
	
	$(#ID_BTN_CANCEL).onClick = function()
	{		
		view.close(null);
	}	
	
	$(#ID_TXT_EMAIL).on("keyup",function(event) {  
		if( event.keyCode == Event.VK_RETURN)
		{
			FunCheckPwdValid();
		}	  
	});
	
	$(#ID_TXT_ANSWER).on("keyup",function(event) {	
		if( event.keyCode == Event.VK_RETURN)
		{
			FunCheckPwdValid();
		}	  
	});
	
	$(#ID_DDBTN_QUESTIONS).on("keyup",function(event) {
		if( event.keyCode == Event.VK_RETURN)
		{
			FunCheckPwdValid();
		}	  
	});
	</script>

	<script type="text/tiscript">
	function FunCheckPwdValid()
	{
		if($(#ID_TXT_EMAIL).value.length == 0 || $(#ID_TXT_EMAIL).value.trim().length == 0)
		{
			self.timer(50ms,function (){
				$(#ID_EXCEPTION_MSG).value = Lang.translate("ID_ENTER_VALID_EMAIL");
				$(.message_display_block_forgotPassword).state.collapsed = true;
			});
			return;
		}
		if(!ValidateEmailID())
		{
			self.timer(50ms,function (){
				$(#ID_EXCEPTION_MSG).value = Lang.translate("ID_ENTER_VALID_EMAIL");
				$(.message_display_block_forgotPassword).state.collapsed = true;
			});
			return;
		}
		if($(#ID_TXT_ANSWER).value.length == 0 || $(#ID_TXT_ANSWER).value.trim().length == 0)
		{
			self.timer(50ms,function (){
				$(#ID_EXCEPTION_MSG).value = Lang.translate("ID_PROV_CORR_Q_A");
				$(.message_display_block_forgotPassword).state.collapsed = true;
			});
			return;
		}
		if(!ValidateQuestion())
		{
			self.timer(50ms,function (){
				$(#ID_EXCEPTION_MSG).value = Lang.translate("ID_PROV_CORR_Q_A");
				$(.message_display_block_forgotPassword).state.collapsed = true;
			});
			return;
		}
		if(view.parameters.varLanguageValue == "ENGLISH")
		{
			var params = {"email":$(#ID_TXT_EMAIL).value.trim(), "password":GetPassword(), "lang":"EN"};
		    view.request {
		    type:#post,
			    url: "http://www.wardwiz.com/forgotpassword/sendmail_en.php",
		        params:params
		    };
		}
		else if(view.parameters.varLanguageValue == "GERMAN")
		{
			var params = {"email":$(#ID_TXT_EMAIL).value.trim(), "password":GetPassword(), "lang":"DE"};
			view.request {
				type:#post,
				url: "http://www.wardwiz.com/forgotpassword/sendmail_de.php",
		        params:params
		    };
		}
		view.parameters.vArr[0].isMailSent = 1;
		view.close(null);
	}
	$(#ID_BTN_CANCEL).onClick = function()
	{		
		view.close(null);
	}	

	</script> 

	<script type="text/tiscript">
	function PasswordEnter(pwd) {
		var t = pwd.value;
		if(	pwd.attributes["type"] == "password")
		{
			pwd.attributes["type"] = "text";
		}	
		else
		{
			pwd.attributes["type"] = "password";
		}			
		pwd.value = t;			
	}
	
	function ChangePwdAttr(pwd) {
		var t = pwd.value;
		pwd.attributes["type"] = "password";
		pwd.value = t;			
	}
	
	$(#BTN_TOGGLE).on("mousedown", function(evt){
		PasswordEnter($(input#ID_TXT_ANSWER));
	});
	
	$(#BTN_TOGGLE).on("mouseup", function(evt){
		ChangePwdAttr($(input#ID_TXT_ANSWER));
	});
	</script>

	<script type="text/tiscript">
	$(body).onClick = function(){
		$(.message_display_block_forgotPassword).state.collapsed = false;
	}	
	
	event change $(#ID_DDBTN_QUESTIONS){
		$(.message_display_block_forgotPassword).state.collapsed = false;
	}
	
	event change $(#ID_TXT_ANSWER){
		$(.message_display_block_forgotPassword).state.collapsed = false;
	}
	
	event change $(#ID_TXT_EMAIL){
		$(.message_display_block_forgotPassword).state.collapsed = false;
	}
	</script> 

	<script type="text/tiscript">
	$(#window-close) << event click()
	{
		view.close(null);
	}
	</script> 
	
	<script type="text/tiscript">
	function OnSetDefaultTheme()
	{
		$(body).style["background-image"] = "url(IDR_JPG_DEFAULT_BACKGRUND.jpg)";
		$(head).$append(<style>@import url(IDR_CSS_MAIN.css);</style>);
	}
	function OnSetDarkTheme()
	{
		$(body).style["background-image"] = "url(IDR_JPG_DARK_THEME.jpg)";
		$(head).$append(<style>@import url(IDR_CSS_MAIN_DARK_THEME.css);</style>);
	}
	function OnSetCrystalTheme()
	{
		$(body).style["background-image"] = "url(IDR_JPG_CRYSTAL_BACKGRUND.jpg)";
		$(head).$append(<style>@import url(IDR_CSS_MAIN_CRYSTAL_THEME.css);</style>);
	}
	</script>	

	<script type="text/tiscript">
	function UpdateForgetPasswordTable()
	{
		DataBase = DB.open(varDB);
		var vQuestion = DataBase.exec("SELECT QUESTION FROM WWIZ_FORGETPASSWORD");
		var vQuestionID;
		if(vQuestion instanceof Recordset)	
		{
			switch(vQuestion["QUESTION"])
			{
				case "What is your sibling name?": vQuestionID = "ID_WHAT_SIBL_NAME"; break;
				case "Which street you were living when you born?" : vQuestionID = "ID_WHICH_STREET_BORN"; break;
				case "What is your favorite school teacher's name?" : vQuestionID = "ID_WHAT_FVRT_TEACHER"; break;
				case "Was ist deine Lieblingsfarbe?" : vQuestionID = "ID_WHAT_FVRT_COLOR"; break;
				case "Wie lautet Ihr Geschwistername?" : vQuestionID = "ID_WHAT_SIBL_NAME"; break;
				case "In welcher Straße lebten Sie, als Sie geboren wurden?" : vQuestionID = "ID_WHICH_STREET_BORN"; break;
				case "Wie heißt Ihr Lieblingslehrer?" : vQuestionID = "ID_WHAT_FVRT_TEACHER"; break;
			}		
			vQuestion.close();
			DataBase.exec("UPDATE WWIZ_FORGETPASSWORD SET QUESTION = ?",vQuestionID);
		}
		DataBase.close();
	}
	</script>	

	<script type="text/tiscript">
	function self.ready() {	
		self.language = view.parameters.varLanguageValue;
		if(view.parameters.varThemeType == "defaultTheme"){
			OnSetDefaultTheme();
		}
		else if(view.parameters.varThemeType == "darkTheme"){
			OnSetDarkTheme();
		}		
		else if(view.parameters.varThemeType == "crystalTheme"){
			OnSetCrystalTheme();
		}
		varDB = view.parameters.vardb;
	    UpdateForgetPasswordTable();
	}
	</script> 
</head>
<body .forgotPassword>
	<div .header_forgotPassword>
		<window-caption role="window-caption">
			<label>ID_FORGOT_PWD_Q</label>
		</window-caption>	
		<window-button #window-close></window-button>
	</div>
	<div .set_label_information_forgot_password>
		<label>ID_FORGOTTON_PWD_AC</label><br/>
	</div>
	<br/>
	<div .set_txt_forgotPassword>
		<div .set_txt_answer><label>ID_EMAIL_ID</label></div>
		<input type="text" maxlength="45" .input_password_forgotPassword style="margin-left:1dip;" #ID_TXT_EMAIL>
	</div>
	<div .set_txt_forgotPassword> 
		<div .set_txt_answer><label>ID_QUESTION_SEMI</label></div>
		<select|dropdown #ID_DDBTN_QUESTIONS style="width:250dip;"> 
		<option value="ID_WHAT_PET_NAME"><label>ID_WHAT_PET_NAME</label></option>
		<option value="ID_WHAT_FVRT_COLOR"><label>ID_WHAT_FVRT_COLOR</label></option>
		<option value="ID_WHAT_SIBL_NAME"><label>ID_WHAT_SIBL_NAME</label></option>
		<option value="ID_WHICH_STREET_BORN"><label>ID_WHICH_STREET_BORN</label></option>
		<option value="ID_WHAT_FVRT_TEACHER"><label>ID_WHAT_FVRT_TEACHER</label></option>
		</select>
	</div>
	<div .set_txt_forgotPassword>
		<widget>
			<div .set_txt_answer><label>ID_ANSWER_SEMI</label></div>
			<input type=password maxlength="20" .input_password_forgotPassword #ID_TXT_ANSWER>
			<div class="eye">
				<button .null_button #BTN_TOGGLE>
					<svg version="1.1" id="Layer_14" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
						viewBox="0 0 500 500" enable-background="new 0 0 500 500" xml:space="preserve" class="eyeIcon">
					<path fill="none" stroke="#000000" stroke-width="15" stroke-miterlimit="10" d="M31,243c0,0,91-129,225-123s214,123,214,123
						s-97,91.2-231,91c-80.3-0.1-166-50.5-208-97"/>
					<circle fill="none" stroke="#000000" stroke-width="15" stroke-miterlimit="10" cx="245.5" cy="222.5" r="69.5"/>
					<path stroke="#000000" stroke-width="15" stroke-miterlimit="10" d="M302,250c0,24-35.2,41.7-59.2,41.7S189,272.3,189,248.2
						s29.8-43.5,53.8-43.5S302,226,302,250z"/>
					</svg>
				</button>
			</div>
		</widget>
	</div>
	<div .btnIcon_forgotPassword>
		<div .btnCstmSmall #ID_BTN_GO><label>ID_GO</label></div>
		<div .btnCstmSmall #ID_BTN_CANCEL><label>ID_CANCEL</label></div>
	</div> 
	<div .message_display_block_forgotPassword>
		<p #ID_EXCEPTION_MSG></p>
	</div>
</body>
</html>